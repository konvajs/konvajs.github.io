<!DOCTYPE html>
<html lang="en">
  <head prefix="og: http://ogp.me/ns#">
    <meta charset="utf-8" />
<title>
   Save and Load HTML5 Canvas Stage Best Practices | Konva - JavaScript 2d canvas
  library
</title>
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=5"
/>
<link rel="canonical" href="https://konvajs.org/docs/data_and_serialization/Best_Practices.html" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff" /> 
<link rel="stylesheet" href="/css/style.css">

<link
  href="//fonts.googleapis.com/css?family=Lato:300,700"
  rel="stylesheet"
  type="text/css"
/>
<link
  href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700"
  rel="stylesheet"
  type="text/css"
/>
<script
  async
  defer
  data-domain="konvajs.org"
  src="https://plausible.io/js/plausible.js"
></script>
<link rel="alternate" href="/atom.xml" title="Konva.js - JavaScript 2d canvas library"> <meta name="description" content="What is the best way to save&#x2F;load full stage content and how to implement undo&#x2F;redo?If you want to save&#x2F;load simple canvas content you can use the built-in Konva methods: node.toJSON() and Node.create">
<meta property="og:type" content="website">
<meta property="og:title" content="Save and Load HTML5 Canvas Stage Best Practices">
<meta property="og:url" content="https://konvajs.org/docs/data_and_serialization/Best_Practices.html">
<meta property="og:site_name" content="Konva.js - JavaScript 2d canvas library">
<meta property="og:description" content="What is the best way to save&#x2F;load full stage content and how to implement undo&#x2F;redo?If you want to save&#x2F;load simple canvas content you can use the built-in Konva methods: node.toJSON() and Node.create">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://konvajs.org/logo.png">
<meta property="article:published_time" content="2024-12-23T14:29:37.831Z">
<meta property="article:modified_time" content="2024-12-23T14:29:37.831Z">
<meta property="article:author" content="Anton Lavrenov">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://konvajs.org/logo.png">
<meta name="twitter:site" content="@lavrton"> 

  </head>
  <body>
    <header id="header">
  <div class="outer">
    <div class="inner">
      <div id="logo-wrap">
        <a href="/" id="logo">Konva</a>
        <a id="main-nav-toggle"></a>
      </div>
      <nav id="main-nav">
        <ul id="main-nav-list">
          
          <li class="main-nav-item">
            <a href="/docs/index.html" class="main-nav-link">
              Tutorials
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/docs/sandbox/index.html" class="main-nav-link">
              Demos
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/api/Konva.html" class="main-nav-link">
              API docs
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/docs/react/Intro.html" class="main-nav-link">
              React
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/docs/vue/index.html" class="main-nav-link">
              Vue
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/docs/svelte/index.html" class="main-nav-link">
              Svelte
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/docs/donate.html" class="main-nav-link">
              ❤️ Support Konva
            </a>
          </li>
          
          <li class="main-nav-item">
            <a href="/docs/support.html" class="main-nav-link">
              Need help?
            </a>
          </li>
          
          <li class="main-nav-item">
            <div id="search-container" />
          </li>
          <li class="main-nav-item">
            <a
              href="https://lavrton.com/consulting"
              title="Consulting"
              target="_blank"
              class="main-nav-link"
              style="
                color: white;
                background: #078c34;
                padding: 10px;
                border-radius: 10px;
              "
              >Consulting</a
            >
          </li>
        </ul>

        <a
          href="https://github.com/konvajs/konva"
          id="github-btn"
          title="GitHub"
          target="_blank"
        ></a>
        <a
          href="https://twitter.com/lavrton"
          id="twitter-btn"
          title="Twitter"
          target="_blank"
        ></a>
        <!--
          <a id="search-btn" class="st-search-launcher" title="Search"></a>
        -->
      </nav>
    </div>
  </div>
</header>
 <article class="page" itemscope itemtype="http://schema.org/Article">
  <header id="page-banner">
    <div class="outer">
      <div id="page-banner-inner">
        <h1 id="page-title" itemprop="name">Save and Load HTML5 Canvas Stage Best Practices</h1>
        <a
          href="https://github.com/konvajs/site/blob/master/source/docs/data_and_serialization/Best_Practices.md"
          title="Improve this doc"
          id="page-edit-link"
        ></a>
      </div>
      <!-- Begin Mailchimp Signup Form -->

<!-- <iframe
  class="mj-w-res-iframe"
  frameborder="0"
  scrolling="no"
  marginheight="0"
  marginwidth="0"
  src="https://app.mailjet.com/widget/iframe/7P23/MU3"
  style="height: 70px; margin: auto; width: 450px"
></iframe> -->

<!-- <script
  type="text/javascript"
  src="https://app.mailjet.com/statics/js/iframeResizer.min.js"
></script> -->

<!--End mc_embed_signup-->

    </div>
  </header>

  <div class="outer">
    <div id="mobile-menu-wrap"></div>
    <aside id="sidebar">
  
    <strong class="sidebar-title">Getting Started</strong>
    
      <a href="/docs/index.html" class="sidebar-link">Intro</a>
    
      <a href="/docs/overview.html" class="sidebar-link">Overview</a>
    
      <a href="/docs/support.html" class="sidebar-link">Need help?</a>
    
      <a href="/docs/donate.html" class="sidebar-link">Support Konva</a>
    
      <a href="/docs/tools.html" class="sidebar-link">Tools</a>
    
  
    <strong class="sidebar-title">Shapes</strong>
    
      <a href="/docs/shapes/Rect.html" class="sidebar-link">Rect</a>
    
      <a href="/docs/shapes/Circle.html" class="sidebar-link">Circle</a>
    
      <a href="/docs/shapes/Ellipse.html" class="sidebar-link">Ellipse</a>
    
      <a href="/docs/shapes/Wedge.html" class="sidebar-link">Wedge</a>
    
      <a href="/docs/shapes/Line_-_Simple_Line.html" class="sidebar-link">Line - Simple Line</a>
    
      <a href="/docs/shapes/Line_-_Polygon.html" class="sidebar-link">Line - Polygon</a>
    
      <a href="/docs/shapes/Line_-_Spline.html" class="sidebar-link">Line - Spline</a>
    
      <a href="/docs/shapes/Line_-_Blob.html" class="sidebar-link">Line - Blob</a>
    
      <a href="/docs/shapes/Sprite.html" class="sidebar-link">Sprite</a>
    
      <a href="/docs/shapes/Image.html" class="sidebar-link">Image</a>
    
      <a href="/docs/shapes/Text.html" class="sidebar-link">Text</a>
    
      <a href="/docs/shapes/TextPath.html" class="sidebar-link">TextPath</a>
    
      <a href="/docs/shapes/Star.html" class="sidebar-link">Star</a>
    
      <a href="/docs/shapes/Ring.html" class="sidebar-link">Ring</a>
    
      <a href="/docs/shapes/Arc.html" class="sidebar-link">Arc</a>
    
      <a href="/docs/shapes/Label.html" class="sidebar-link">Label</a>
    
      <a href="/docs/shapes/Path.html" class="sidebar-link">Path</a>
    
      <a href="/docs/shapes/RegularPolygon.html" class="sidebar-link">RegularPolygon</a>
    
      <a href="/docs/shapes/Arrow.html" class="sidebar-link">Arrow</a>
    
      <a href="/docs/shapes/Custom.html" class="sidebar-link">Custom</a>
    
  
    <strong class="sidebar-title">Guides</strong>
    
      <a href="/docs/posts/Position_vs_Offset.html" class="sidebar-link">Position vs Offset</a>
    
      <a href="/docs/posts/Tainted_Canvas.html" class="sidebar-link">Tainted Canvas Issue</a>
    
  
    <strong class="sidebar-title">Styling</strong>
    
      <a href="/docs/styling/Fill.html" class="sidebar-link">Fill</a>
    
      <a href="/docs/styling/Stroke.html" class="sidebar-link">Stroke</a>
    
      <a href="/docs/styling/Opacity.html" class="sidebar-link">Opacity</a>
    
      <a href="/docs/styling/Shadow.html" class="sidebar-link">Shadow</a>
    
      <a href="/docs/styling/Line_Join.html" class="sidebar-link">Line Join</a>
    
      <a href="/docs/styling/Hide_and_Show.html" class="sidebar-link">Hide and Show</a>
    
      <a href="/docs/styling/Mouse_Cursor.html" class="sidebar-link">Mouse Cursor Style</a>
    
      <a href="/docs/styling/Blend_Mode.html" class="sidebar-link">Blend Mode</a>
    
      <a href="/docs/styling/Fill_Stroke_Order.html" class="sidebar-link">Fill Stroke Order</a>
    
  
    <strong class="sidebar-title">Events</strong>
    
      <a href="/docs/events/Binding_Events.html" class="sidebar-link">Binding Events</a>
    
      <a href="/docs/events/Mobile_Events.html" class="sidebar-link">Mobile Events</a>
    
      <a href="/docs/events/Pointer_Events.html" class="sidebar-link">Pointer Events</a>
    
      <a href="/docs/events/Desktop_and_Mobile.html" class="sidebar-link">Desktop and Mobile Event</a>
    
      <a href="/docs/events/Mobile_Scrolling.html" class="sidebar-link">Mobile Scrolling</a>
    
      <a href="/docs/events/Multi_Event.html" class="sidebar-link">Multi Event</a>
    
      <a href="/docs/events/Remove_Event.html" class="sidebar-link">Remove Event</a>
    
      <a href="/docs/events/Remove_by_Name.html" class="sidebar-link">Remove by Name</a>
    
      <a href="/docs/events/Listen_for_Events.html" class="sidebar-link">Listen for Events</a>
    
      <a href="/docs/events/Cancel_Propagation.html" class="sidebar-link">Cancel Propagation</a>
    
      <a href="/docs/events/Event_Delegation.html" class="sidebar-link">Event Delegation</a>
    
      <a href="/docs/events/Fire_Events.html" class="sidebar-link">Fire Events</a>
    
      <a href="/docs/events/Stage_Events.html" class="sidebar-link">Stage Events</a>
    
      <a href="/docs/events/Custom_Hit_Region.html" class="sidebar-link">Custom Hit Region</a>
    
      <a href="/docs/events/Image_Events.html" class="sidebar-link">Image Hit Region</a>
    
      <a href="/docs/events/Keyboard_Events.html" class="sidebar-link">Keyboard Events</a>
    
      <a href="/docs/events/Desktop_and_Mobile.html" class="sidebar-link">Desktop and Mobile</a>
    
  
    <strong class="sidebar-title">Drag and Drop</strong>
    
      <a href="/docs/drag_and_drop/Drag_and_Drop.html" class="sidebar-link">Drag and Drop</a>
    
      <a href="/docs/drag_and_drop/Drag_an_Image.html" class="sidebar-link">Drag an Image</a>
    
      <a href="/docs/drag_and_drop/Drag_a_Group.html" class="sidebar-link">Drag a Group</a>
    
      <a href="/docs/drag_and_drop/Drag_a_Line.html" class="sidebar-link">Drag a Line</a>
    
      <a href="/docs/drag_and_drop/Drag_a_Stage.html" class="sidebar-link">Drag a Stage</a>
    
      <a href="/docs/drag_and_drop/Drag_Events.html" class="sidebar-link">Drag Events</a>
    
      <a href="/docs/drag_and_drop/Simple_Drag_Bounds.html" class="sidebar-link">Simple Drag Bounds</a>
    
      <a href="/docs/drag_and_drop/Complex_Drag_and_Drop.html" class="sidebar-link">Complex Drag and Drop</a>
    
      <a href="/docs/drag_and_drop/Drop_Events.html" class="sidebar-link">Drop Events</a>
    
  
    <strong class="sidebar-title">Select and Transform</strong>
    
      <a href="/docs/select_and_transform/Basic_demo.html" class="sidebar-link">Basic demo</a>
    
      <a href="/docs/select_and_transform/Centered_Scaling.html" class="sidebar-link">Centered Scaling</a>
    
      <a href="/docs/select_and_transform/Keep_Ratio.html" class="sidebar-link">Keep Ratio</a>
    
      <a href="/docs/select_and_transform/Transformer_Styling.html" class="sidebar-link">Styling</a>
    
      <a href="/docs/select_and_transform/Transformer_Complex_Styling.html" class="sidebar-link">Complex Styling</a>
    
      <a href="/docs/select_and_transform/Transform_Events.html" class="sidebar-link">Transform Events</a>
    
      <a href="/docs/select_and_transform/Resize_Limits.html" class="sidebar-link">Resize Limits</a>
    
      <a href="/docs/select_and_transform/Rotation_Snaps.html" class="sidebar-link">Rotation Snaps</a>
    
      <a href="/docs/select_and_transform/Resize_Snaps.html" class="sidebar-link">Resize Snaps</a>
    
      <a href="/docs/select_and_transform/Stop_Transform.html" class="sidebar-link">Stop Transform</a>
    
      <a href="/docs/select_and_transform/Force_Update.html" class="sidebar-link">Force Update</a>
    
      <a href="/docs/select_and_transform/Resize_Text.html" class="sidebar-link">Text Resizing</a>
    
      <a href="/docs/select_and_transform/Ignore_Stroke_On_Transform.html" class="sidebar-link">Ignore Stroke</a>
    
  
    <strong class="sidebar-title">Clipping</strong>
    
      <a href="/docs/clipping/Clipping_Regions.html" class="sidebar-link">Simple Clip</a>
    
      <a href="/docs/clipping/Clipping_Function.html" class="sidebar-link">Complex Clip</a>
    
  
    <strong class="sidebar-title">Groups, Layers and Ordering</strong>
    
      <a href="/docs/groups_and_layers/Groups.html" class="sidebar-link">Groups</a>
    
      <a href="/docs/groups_and_layers/Layering.html" class="sidebar-link">Layering</a>
    
      <a href="/docs/groups_and_layers/Change_Containers.html" class="sidebar-link">Change Containers</a>
    
      <a href="/docs/groups_and_layers/zIndex.html" class="sidebar-link">zIndex</a>
    
  
    <strong class="sidebar-title">Filters</strong>
    
      <a href="/docs/filters/Blur.html" class="sidebar-link">Blur</a>
    
      <a href="/docs/filters/Brighten.html" class="sidebar-link">Brighten</a>
    
      <a href="/docs/filters/Contrast.html" class="sidebar-link">Contrast</a>
    
      <a href="/docs/filters/Emboss.html" class="sidebar-link">Emboss</a>
    
      <a href="/docs/filters/Enhance.html" class="sidebar-link">Enhance</a>
    
      <a href="/docs/filters/Grayscale.html" class="sidebar-link">Grayscale</a>
    
      <a href="/docs/filters/HSL.html" class="sidebar-link">HSL</a>
    
      <a href="/docs/filters/HSV.html" class="sidebar-link">HSV</a>
    
      <a href="/docs/filters/RGB.html" class="sidebar-link">RGB</a>
    
      <a href="/docs/filters/Invert.html" class="sidebar-link">Invert</a>
    
      <a href="/docs/filters/Kaleidoscope.html" class="sidebar-link">Kaleidoscope</a>
    
      <a href="/docs/filters/Mask.html" class="sidebar-link">Mask</a>
    
      <a href="/docs/filters/Noise.html" class="sidebar-link">Noise</a>
    
      <a href="/docs/filters/Pixelate.html" class="sidebar-link">Pixelate</a>
    
      <a href="/docs/filters/Custom_Filter.html" class="sidebar-link">Custom Filter</a>
    
      <a href="/docs/filters/Multiple_Filters.html" class="sidebar-link">Multiple Filters</a>
    
  
    <strong class="sidebar-title">Tweens</strong>
    
      <a href="/docs/tweens/Linear_Easing.html" class="sidebar-link">Linear Easing</a>
    
      <a href="/docs/tweens/Common_Easings.html" class="sidebar-link">Common Easings</a>
    
      <a href="/docs/tweens/All_Easings.html" class="sidebar-link">All Easings</a>
    
      <a href="/docs/tweens/Finish_Event.html" class="sidebar-link">Finish Event</a>
    
      <a href="/docs/tweens/All_Controls.html" class="sidebar-link">All Controls</a>
    
      <a href="/docs/tweens/Tween_Filter.html" class="sidebar-link">Tween Filter</a>
    
      <a href="/docs/tweens/Complex_Tweening.html" class="sidebar-link">Complex Tweening</a>
    
  
    <strong class="sidebar-title">Animations</strong>
    
      <a href="/docs/animations/Create_an_Animation.html" class="sidebar-link">Create an Animation</a>
    
      <a href="/docs/animations/Moving.html" class="sidebar-link">Moving</a>
    
      <a href="/docs/animations/Rotation.html" class="sidebar-link">Rotation</a>
    
      <a href="/docs/animations/Scaling.html" class="sidebar-link">Scaling</a>
    
      <a href="/docs/animations/Stop_Animation.html" class="sidebar-link">Stop Animation</a>
    
  
    <strong class="sidebar-title">Selectors</strong>
    
      <a href="/docs/selectors/Select_by_id.html" class="sidebar-link">Select by id</a>
    
      <a href="/docs/selectors/Select_by_Type.html" class="sidebar-link">Select by Type</a>
    
      <a href="/docs/selectors/Select_by_Name.html" class="sidebar-link">Select by Name</a>
    
  
    <strong class="sidebar-title">Data &amp; Serialization &amp; Export</strong>
    
      <a href="/docs/data_and_serialization/Serialize_a_Stage.html" class="sidebar-link">Serialize a Stage</a>
    
      <a href="/docs/data_and_serialization/Simple_Load.html" class="sidebar-link">Simple Load</a>
    
      <a href="/docs/data_and_serialization/Complex_Load.html" class="sidebar-link">Complex Load</a>
    
      <a href="/docs/data_and_serialization/Best_Practices.html" class="sidebar-link current">JSON Best Practices</a>
    
      <a href="/docs/data_and_serialization/Stage_Data_URL.html" class="sidebar-link">Stage Data URL</a>
    
      <a href="/docs/data_and_serialization/High-Quality-Export.html" class="sidebar-link">Export to HD Image</a>
    
  
    <strong class="sidebar-title">Performance</strong>
    
      <a href="/docs/performance/All_Performance_Tips.html" class="sidebar-link">All tips</a>
    
      <a href="/docs/performance/Layer_Management.html" class="sidebar-link">Layer Management</a>
    
      <a href="/docs/performance/Batch_Draw.html" class="sidebar-link">Batch Draw</a>
    
      <a href="/docs/performance/Shape_Caching.html" class="sidebar-link">Shape Caching</a>
    
      <a href="/docs/performance/Optimize_Animation.html" class="sidebar-link">Optimize Animation</a>
    
      <a href="/docs/performance/Optimize_Strokes.html" class="sidebar-link">Optimize Strokes</a>
    
      <a href="/docs/performance/Shape_Redraw.html" class="sidebar-link">Shape Redraw</a>
    
      <a href="/docs/performance/Disable_Perfect_Draw.html" class="sidebar-link">Disable Perfect Drawing</a>
    
      <a href="/docs/performance/Listening_False.html" class="sidebar-link">Listening False</a>
    
      <a href="/docs/performance/Avoid_Memory_Leaks.html" class="sidebar-link">Avoid Memory Leaks</a>
    
  
</aside>
    <div class="page-content">
      <!--<div class="toc-wrap">-->
      <!--<strong class="toc-title">Contents</strong>-->
      <!--<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-the-best-way-to-save-load-full-stage-content-and-how-to-implement-undo-redo"><span class="toc-number">1.</span> <span class="toc-text">What is the best way to save&#x2F;load full stage content and how to implement undo&#x2F;redo?</span></a></li></ol>-->
      <!--</div>-->
      <div class="page-entry" itemprop="articleBody"><h2 id="What-is-the-best-way-to-save-load-full-stage-content-and-how-to-implement-undo-redo"><a href="#What-is-the-best-way-to-save-load-full-stage-content-and-how-to-implement-undo-redo" class="headerlink" title="What is the best way to save/load full stage content and how to implement undo/redo?"></a>What is the best way to save/load full stage content and how to implement undo/redo?</h2><p>If you want to save/load simple canvas content you can use the built-in <code>Konva</code> methods: <code>node.toJSON()</code> and <code>Node.create(json)</code>.<br>See <a href="/docs/data_and_serialization/Simple_Load.html">simple</a> and <a href="/docs/data_and_serialization/Complex_Load.html">complex</a> demos.</p>
<p>But those methods are useful only in very small apps. In bigger apps it is VERY hard to use those methods. Why? Because the tree structure is usually very complex in larger apps, you may have a lot of event listeners, images, filters, etc. That data is not serializable into JSON (or it is very hard to do that).</p>
<p>Also it is very common that nodes in a tree have a lot information that is not directly related to the state of your app, but just used to describe visual view of your app.</p>
<p>For instance, let’s think we have a game, that draws several balls in canvas. The balls are not just circles, but the complex visual groups of objects with shadows and texts inside them (like “Made in China”). Now let’s think you want to serialize state of your app and use it somewhere else. Like send to another computer or implement undo/redo. Almost all the visual information (shadows, texts, sizes) is not critical and may be you don’t need to save it. Because all balls have the same shadows, sizes, etc. But what is critical? In that case it is just a number of balls and their coordinates. You need to save/load only that information. It will be just a simple array:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> state = [&#123;<span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">10</span>&#125;, &#123; <span class="attr">x</span>: <span class="number">160</span>, <span class="attr">y</span>: <span class="number">1041</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>Now when you have that information, you need to have a function, that can create the whole canvas structure.<br>If you want to update your canvas, for instance, you want to create a new ball, you don’t need to create a new canvas node directly (like creating new instance of <code>Konva.Circle</code>), you just need to push a new object into a state and update (or recreate) canvas.</p>
<p>In that case you don’t need to care about image loading, filters, event listeners, etc in saving/loading phases. Because you do all these actions in your <code>create</code> or <code>update</code> functions.</p>
<p>You would better understand what I am talking about if you know how many modern frameworks work (like <code>React</code>, <code>Vue</code>, <code>Angular</code> and many other).</p>
<p>Also take a look into these demos to have a better idea:</p>
<ol>
<li><a href="/docs/react/Undo-Redo.html">Undo/redo with react</a></li>
<li><a href="/docs/vue/Save-Load.html">Save/load with Vue</a></li>
</ol>
<p>How to implement that <code>create</code> and <code>update</code> functions? It depends. From my point of view it will be easier to use frameworks that can do that job for you, like <a href="/docs/react/">react-konva</a>.</p>
<p>If you don’t want to use such frameworks you need to think in terms of your own app. Here I will try to make a small demo to give you an idea.</p>
<p>The super naive method is to implement just one function <code>create(state)</code> that will do all the complex job of loading.<br>If you have some changes in your app you just need to destroy the canvas and create a new one. But the drawback of such approach is possibly a bad performance.</p>
<p>A bit smarter implementation is to create two functions <code>create(state)</code> and <code>update(state)</code>. <code>create</code> will make instances of all required objects, attach events and load images. <code>update</code> will update properties of nodes. If number of objects is changed - destroy all and create from scratch. If only some properties changed - call <code>update</code>.</p>
<p>Instructions: In that demo we will have a bunch of images with filters, and you can add more, move them, apply a new filter by clicking on images and use undo/redo.</p>
<iframe src="/downloads/code/data_and_serialization/Best_Practices.html" width="100%" height="300" frameborder="0" loading="lazy" allowfullscreen></iframe>

<figure class="highlight html"><figcaption><span>Konva Load Complex Stage Demo</span><a href="/downloads/code/data_and_serialization/Best_Practices.html">view raw</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/konva@9.3.19/konva.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Konva Load Complex Stage Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      body {</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">        overflow: hidden;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#f0f0f0</span>;</span></span><br><span class="line">      }</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"create-yoda"</span>&gt;</span>Create yoda<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"create-darth"</span>&gt;</span>Create darth<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"undo"</span>&gt;</span>Undo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"redo"</span>&gt;</span>Redo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> possibleFilters = [<span class="string">''</span>, <span class="string">'blur'</span>, <span class="string">'invert'</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">createObject</span><span class="params">(attrs)</span> </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Object</span>.assign({}, attrs, {</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// define position</span></span></span><br><span class="line">          x: 0,</span><br><span class="line">          y: 0,</span><br><span class="line"><span class="actionscript">          <span class="comment">// here should be url to image</span></span></span><br><span class="line"><span class="actionscript">          src: <span class="string">''</span>,</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// and define filter on it, let's define that we can have only</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// "blur", "invert" or "" (none)</span></span></span><br><span class="line"><span class="actionscript">          filter: <span class="string">'blur'</span>,</span></span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">createYoda</span><span class="params">(attrs)</span> </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Object</span>.assign(createObject(attrs), {</span></span><br><span class="line"><span class="actionscript">          src: <span class="string">'/assets/yoda.jpg'</span>,</span></span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">createDarth</span><span class="params">(attrs)</span> </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Object</span>.assign(createObject(attrs), {</span></span><br><span class="line"><span class="actionscript">          src: <span class="string">'/assets/darth-vader.jpg'</span>,</span></span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// initial state</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> state = [createYoda({ x: <span class="number">50</span>, y: <span class="number">50</span> })];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// our history</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> appHistory = [state];</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> appHistoryStep = <span class="number">0</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> width = <span class="built_in">window</span>.innerWidth;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> height = <span class="built_in">window</span>.innerHeight;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> stage = <span class="keyword">new</span> Konva.Stage({</span></span><br><span class="line"><span class="actionscript">        container: <span class="string">'container'</span>,</span></span><br><span class="line">        width: width,</span><br><span class="line">        height: height,</span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> layer = <span class="keyword">new</span> Konva.Layer();</span></span><br><span class="line">      stage.add(layer);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// create function will destroy previous drawing</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">// then it will created required nodes and attach all events</span></span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">()</span> </span>{</span></span><br><span class="line">        layer.destroyChildren();</span><br><span class="line"><span class="javascript">        state.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> {</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> node = <span class="keyword">new</span> Konva.Image({</span></span><br><span class="line"><span class="actionscript">            draggable: <span class="literal">true</span>,</span></span><br><span class="line"><span class="actionscript">            name: <span class="string">'item-'</span> + index,</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// make it smaller</span></span></span><br><span class="line">            scaleX: 0.5,</span><br><span class="line">            scaleY: 0.5,</span><br><span class="line">          });</span><br><span class="line">          layer.add(node);</span><br><span class="line"><span class="actionscript">          node.on(<span class="string">'dragend'</span>, () =&gt; {</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// make new state</span></span></span><br><span class="line">            state = state.slice();</span><br><span class="line"><span class="actionscript">            <span class="comment">// update object data</span></span></span><br><span class="line"><span class="javascript">            state[index] = <span class="built_in">Object</span>.assign({}, state[index], {</span></span><br><span class="line">              x: node.x(),</span><br><span class="line">              y: node.y(),</span><br><span class="line">            });</span><br><span class="line"><span class="actionscript">            <span class="comment">// save it into history</span></span></span><br><span class="line">            saveStateToHistory(state);</span><br><span class="line"><span class="actionscript">            <span class="comment">// don't need to call update here</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// because changes already in node</span></span></span><br><span class="line">          });</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          node.on(<span class="string">'click'</span>, () =&gt; {</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// find new filter</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> oldFilterIndex = possibleFilters.indexOf(state[index].filter);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> nextIndex = (oldFilterIndex + <span class="number">1</span>) % possibleFilters.length;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> filter = possibleFilters[nextIndex];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="comment">// apply state changes</span></span></span><br><span class="line">            state = state.slice();</span><br><span class="line"><span class="javascript">            state[index] = <span class="built_in">Object</span>.assign({}, state[index], {</span></span><br><span class="line">              filter: filter,</span><br><span class="line">            });</span><br><span class="line"><span class="actionscript">            <span class="comment">// save state to history</span></span></span><br><span class="line">            saveStateToHistory(state);</span><br><span class="line"><span class="actionscript">            <span class="comment">// update canvas from state</span></span></span><br><span class="line">            update(state);</span><br><span class="line">          });</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="built_in">window</span>.Image();</span></span><br><span class="line"><span class="actionscript">          img.onload = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</span></span><br><span class="line">            node.image(img);</span><br><span class="line">            update(state);</span><br><span class="line">          };</span><br><span class="line">          img.src = item.src;</span><br><span class="line">        });</span><br><span class="line">        update(state);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span> </span>{</span></span><br><span class="line"><span class="actionscript">        state.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(item, index)</span> </span>{</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> node = stage.findOne(<span class="string">'.item-'</span> + index);</span></span><br><span class="line">          node.setAttrs({</span><br><span class="line">            x: item.x,</span><br><span class="line">            y: item.y,</span><br><span class="line">          });</span><br><span class="line"></span><br><span class="line">          if (!node.image()) {</span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span>;</span></span><br><span class="line">          }</span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (item.filter === <span class="string">'blur'</span>) {</span></span><br><span class="line">            node.filters([Konva.Filters.Blur]);</span><br><span class="line">            node.blurRadius(10);</span><br><span class="line">            node.cache();</span><br><span class="line"><span class="actionscript">          } <span class="keyword">else</span> <span class="keyword">if</span> (item.filter === <span class="string">'invert'</span>) {</span></span><br><span class="line">            node.filters([Konva.Filters.Invert]);</span><br><span class="line">            node.cache();</span><br><span class="line"><span class="actionscript">          } <span class="keyword">else</span> {</span></span><br><span class="line">            node.filters([]);</span><br><span class="line">            node.clearCache();</span><br><span class="line">          }</span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">//</span></span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">saveStateToHistory</span><span class="params">(state)</span> </span>{</span></span><br><span class="line">        appHistory = appHistory.slice(0, appHistoryStep + 1);</span><br><span class="line">        appHistory = appHistory.concat([state]);</span><br><span class="line">        appHistoryStep += 1;</span><br><span class="line">      }</span><br><span class="line">      create(state);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span></span></span><br><span class="line"><span class="actionscript">        .querySelector(<span class="string">'#create-yoda'</span>)</span></span><br><span class="line"><span class="actionscript">        .addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// create new object</span></span></span><br><span class="line">          state.push(</span><br><span class="line">            createYoda({</span><br><span class="line"><span class="javascript">              x: width * <span class="built_in">Math</span>.random(),</span></span><br><span class="line"><span class="javascript">              y: height * <span class="built_in">Math</span>.random(),</span></span><br><span class="line">            })</span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="comment">// recreate canvas</span></span></span><br><span class="line">          create(state);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span></span></span><br><span class="line"><span class="actionscript">        .querySelector(<span class="string">'#create-darth'</span>)</span></span><br><span class="line"><span class="actionscript">        .addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// create new object</span></span></span><br><span class="line">          state.push(</span><br><span class="line">            createDarth({</span><br><span class="line"><span class="javascript">              x: width * <span class="built_in">Math</span>.random(),</span></span><br><span class="line"><span class="javascript">              y: height * <span class="built_in">Math</span>.random(),</span></span><br><span class="line">            })</span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="comment">// recreate canvas</span></span></span><br><span class="line">          create(state);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.querySelector(<span class="string">'#undo'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line">        if (appHistoryStep === 0) {</span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span>;</span></span><br><span class="line">        }</span><br><span class="line">        appHistoryStep -= 1;</span><br><span class="line">        state = appHistory[appHistoryStep];</span><br><span class="line"><span class="actionscript">        <span class="comment">// create everything from scratch</span></span></span><br><span class="line">        create(state);</span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.querySelector(<span class="string">'#redo'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line">        if (appHistoryStep === appHistory.length - 1) {</span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span>;</span></span><br><span class="line">        }</span><br><span class="line">        appHistoryStep += 1;</span><br><span class="line">        state = appHistory[appHistoryStep];</span><br><span class="line"><span class="actionscript">        <span class="comment">// create everything from scratch</span></span></span><br><span class="line">        create(state);</span><br><span class="line">      });</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div>
      <footer id="page-footer"><a href="/docs/data_and_serialization/Complex_Load.html" id="page-footer-prev" title="Complex Load">Prev</a><a href="/docs/data_and_serialization/Stage_Data_URL.html" id="page-footer-next" title="Stage Data URL">Next</a></footer>
      <div style="padding: 30px; font-size: 18px; text-align: center; color: grey">
  Enjoying Konva? Please consider to
  <a href="/docs/donate.html">support</a> the project.
</div>

<section id="comments" style="margin-top: 50px">
  <div id="disqus_thread">
    <noscript
      >Please enable JavaScript to view the
      <a href="//disqus.com/?ref_noscript"
        >comments powered by Disqus.</a
      ></noscript
    >
  </div>
</section>


    </div>
  </div>
</article>
 <footer id="footer">
  <div class="outer">
      <div class="inner">
          <!-- Begin Mailchimp Signup Form -->

<!-- <iframe
  class="mj-w-res-iframe"
  frameborder="0"
  scrolling="no"
  marginheight="0"
  marginwidth="0"
  src="https://app.mailjet.com/widget/iframe/7P23/MU3"
  style="height: 70px; margin: auto; width: 450px"
></iframe> -->

<!-- <script
  type="text/javascript"
  src="https://app.mailjet.com/statics/js/iframeResizer.min.js"
></script> -->

<!--End mc_embed_signup-->

        </div>
    <div class="inner">
      <div class="footer-resources">
        <h3>Docs</h3>
        <ul>
          <li><a href="/docs">Tutorials</a></li>
          <li><a href="/docs/overview.html">General Overview</a></li>
          <li><a href="/api/Konva.html">API doc</a></li>

          <li><a href="/docs/sandbox/index.html">Demos</a></li>
          <li><a href="/docs/react/index.html">Usage with React</a></li>
          <li><a href="/docs/vue/index.html">Usage with Vue</a></li>
          <li>
            <a href="https://github.com/konvajs/konva/blob/master/CHANGELOG.md"
              >Changelog</a
            >
          </li>
        </ul>
      </div>
      <div class="footer-resources">
        <h3>CHANNELS</h3>
        <ul>
          <li>
            <a href="https://github.com/konvajs/konva" target="_blank"
              >GitHub</a
            >
          </li>
          <li>
            <a
              href="https://stackoverflow.com/questions/tagged/konvajs"
              target="_blank"
              >StackOverflow</a
            >
          </li>
          <li><a href="https://discord.gg/8FqZwVT" target="_blank">Discord chat</a></li>
          <li>
            <a href="https://github.com/konvajs/konva/blob/master/CHANGELOG.md" target="_blank"
              >Changelog</a
            >
          </li>
        </ul>
        
      </div>
      <div class="footer-resources">
          <h3>More</h3>
          <ul>
            <li>
              <a href="/docs/support.html"
                >Need help?</a
              >
            </li>
            <li>
              <a
                href="/docs/donate.html"
                target="_blank"
                >Donate</a>
            </li>
            <li>
              <a
                href="https://polotno.com/"
                target="_blank"
                >Design Editor SDK</a>
            </li>
          </ul>
    </div>
    <div class="inner">
        <div id="footer-copyright">
            &copy; 2025 KonvaJS<br />
          </div>
      <div id="footer-links">
        <a
          href="https://twitter.com/lavrton"
          id="footer-link-twitter"
          class="footer-link"
          target="_blank"
          ><span>Twitter</span></a
        >
        <a
          href="https://github.com/konvajs/konva"
          id="footer-link-github"
          class="footer-link"
          target="_blank"
          ><span>GitHub</span></a
        >
      </div>
    </div>
  
  </div>

  <a class="chat-button" href="https://discord.gg/8FqZwVT" target="_blank" rel="noopener">Join discord chat</a>
  
  <!-- <iframe src="https://discord.com/widget?id=753274212814422176&theme=dark" width="350" height="500" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe> -->
 
</footer>
 
<!-- Disqus -->
<script>
  var disqus_shortname = 'konvajs';
  
  var disqus_url = 'https://konvajs.org/docs/data_and_serialization/Best_Practices.html';
  
    (function () {
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.defer = true;
      dsq.src = '//go.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha"
/>
<script
  type="text/javascript"
  src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"
></script>
<script type="text/javascript">
  docsearch({
    apiKey: '79bc02f9230d7d4c985e6f543a0a6427',
    appId: '8J5ZKQ6RXR',
    indexName: 'konvajs',
    container: '#search-container',
    algoliaOptions: {
      hitsPerPage: 10,
      // See https://www.algolia.com/doc/api-reference/api-parameters/
    },
    // transformData: function (suggestions) {
    //   // Transform the list of suggestions, and the return the updated list
    //   suggestions.sort(function (a, b) {
    //     if (a.url.indexOf('/api/') >= 0) {
    //       return 1;
    //     } else {
    //       return -1;
    //     }
    //   });
    //   return suggestions.slice(0, 10);
    // },
    debug: false, // Set debug to true if you want to inspect the dropdown
  });
</script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script src="/js/retina.min.js"></script>
 
<script src="/js/script.js"></script>

<!-- Google+ -->
<!-- <script type="text/javascript" src="//apis.google.com/js/plusone.js"></script> -->
<!-- Twitter -->
<!-- <script>
  !(function(d, s, id) {
    var js,
      fjs = d.getElementsByTagName(s)[0],
      p = /^http:/.test(d.location) ? 'http' : 'https';
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id = id;
      js.src = p + '://platform.twitter.com/widgets.js';
      fjs.parentNode.insertBefore(js, fjs);
    }
  })(document, 'script', 'twitter-wjs');
</script> -->

  </body>
  <script type="text/javascript">
    !(function (e, t) {
      ((e = t.createElement('script')).src =
        'https://cdn.convertbox.com/convertbox/js/embed.js'),
        (e.id = 'app-convertbox-script'),
        (e.async = true),
        (e.dataset.uuid = 'db9e320b-6d6c-49c4-ba5c-b29e6d5fc91c'),
        document.getElementsByTagName('head')[0].appendChild(e);
    })(window, document);
  </script>
</html>
